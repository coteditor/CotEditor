<!DOCTYPE html>
<html lang="ja">

<head>
	<meta charset="UTF-8">
	<meta name="keywords" content="スクリプトメニュー, スクリプト, スクリプティング">
	<link rel="stylesheet" href="../../Shared/sty/standard.css">
	<script defer src="../../Shared/js/toc.js"></script>
	
	<title>MacのCotEditorでUNIXスクリプトを使って作業を自動化する</title>
</head>

<body>

<h1>MacのCotEditorでUNIXスクリプトを使って作業を自動化する</h1>

<p>CotEditorのスクリプトメニューからUNIXスクリプトを実行して、CotEditorで編集中の書類の情報やテキストをスクリプトに渡したり、スクリプトの実行結果をその書類に反映したりできます。</p>


<section>
<h2>スクリプトメニュー用のUNIXスクリプトを作成する</h2>

<p>CotEditor用のUNIXスクリプトは、実行環境がMacに用意されていればどんなスクリプト言語でも作成できます。ただし、スクリプトファイルは、.sh、.pl、.php、.rb、.py、.js、.awk、または.swiftのいずれかの拡張子を付ける必要があります。</p>

<p>スクリプトを正しく実行するには、使用するインタープリタを指定する<code>#!</code>（shebang）行をスクリプトに含め、スクリプトファイルが実行可能である必要があります。例えば、<a href="https://support.apple.com/guide/terminal/APDD100908F-06B3-4E63-8A87-32E71241BAB4/" rel="external">Macの「ターミナル」でファイルを実行可能ファイルにする</a>ことができます。</p>
</section>


<section>
<h2>ファイルパスを参照する</h2>

<p>現在の書類が保存済みのときは、その書類の絶対ファイルパスが引数 (argv) としてスクリプトに渡されます。</p>
</section>


<section>
<h2>スクリプトにテキストを渡す</h2>

<p>現在の書類の内容を標準入力としてスクリプトに渡すことができます。スクリプトにCotEditorからデータを渡すには、スクリプトの冒頭にコメントを置き、固定テキスト「<code>%%%{CotEditorXInput=<var>xxxx</var>}%%%</code>」を埋め込みます。「<code><var>xxxx</var></code>」で、受け渡すデータを指定します。このコメントを記述しなかった場合は「<code>None</code>」と同等の処理となり何もスクリプトに渡されません。</p>

<p>「<code><var>xxxx</var></code>」には以下のいずれかの入力元を指定することができます:</p>
<table>
	<thead>
		<tr><th>キーワード</th><th>説明</th></tr>
	</thead>
	<tbody>
		<tr><th><code>Selection</code></th><td><p>現在選択しているテキスト</p></td></tr>
		<tr><th><code>AllText</code></th><td><p>書類のすべてのテキスト</p></td></tr>
		<tr><th><code>None</code></th><td><p>何も渡さない（デフォルト）</p></td></tr>
	</tbody>
</table>

<p>スクリプトに渡されるテキストのエンコーディングは、書類のテキストエンコーディングに関わらず常にUTF-8です。</p>
</section>


<section>
<h2>スクリプトの出力を受け取る</h2>

<p>スクリプトから標準出力に送ったテキストはCotEditorで受け取り書類などに反映できます。CotEditorでスクリプトの出力を受け取るには、スクリプトの冒頭にコメントとして固定テキスト「<code>%%%{CotEditorXOutput=<var>xxxx</var>}%%%</code>」を埋め込み、「<code><var>xxxx</var></code>」で受け取ったあとの処理を指定します。このコメントを記述しなかった場合は「<code>Discard</code>」と同等の処理となり出力は無視されます。</p>


<p>「<code><var>xxxx</var></code>」には以下のいずれかの出力先を指定することができます:</p>
<table>
	<thead>
		<tr><th>キーワード</th><th>説明</th></tr>
	</thead>
	<tbody>
		<tr><th><code>ReplaceSelection</code></th><td><p>現在選択しているテキストを出力内容で置き換えます。</p></td></tr>
		<tr><th><code>ReplaceAllText</code></th><td><p>書類のすべてのテキストを出力内容で置き換えます。</p></td></tr>
		<tr><th><code>InsertAfterSelection</code></th><td><p>選択範囲の直後に出力内容を挿入します。</p></td></tr>
		<tr><th><code>AppendToAllText</code></th><td><p>書類の末尾に出力内容を挿入します。</p></td></tr>
		<tr><th><code>NewDocument</code></th><td><p>新規書類を作成し、そこに出力内容を挿入します。</p></td></tr>
		<tr><th><code>Pasteboard puts</code></th><td><p>クリップボードに出力内容を格納します。</p></td></tr>
		<tr><th><code>Discard</code></th><td><p>何もしない（デフォルト）</p></td></tr>
	</tbody>
</table>

<p>スクリプトからCotEditorに返すテキストのエンコーディングは、書類のテキストエンコーディングに関わらず常にUTF-8でなければなりません。</p>
</section>


<section>
<h2>コンソールにテキストを表示する</h2>

<p>標準エラー出力に投げられたテキストはコンソールウインドウに出力されます。</p>
</section>


<section>
<h2>スクリプトを書く</h2>

<p>例えば、以下のPythonスクリプトは、現在の書類の選択範囲内のすべての行の行頭に「&gt;」を追加し、さらに処理した行数をコンソールに表示します。</p>

<pre class="source"><code><span class="comment">#!/usr/bin/env python3
# %%%{CotEditorXInput=Selection}%%%
# %%%{CotEditorXOutput=ReplaceSelection}%%%</span>

<span class="keyword">import</span> sys

count = 0
<span class="keyword">for</span> line <span class="keyword">in</span> sys.stdin:
    count += 1
    <span class="command">print</span>(<span class="string">&quot;&gt;&quot;</span> + line.<span class="command">rstrip</span>())
sys.stderr.<span class="command">write</span>(<span class="string">&quot;Processed {} lines.&quot;</span>.<span class="command">format</span>(count))
</code></pre>

<p>このスクリプトをCotEditorのスクリプトメニューから実行すると、以下のメッセージがコンソールに表示されます:</p>
<figure>
	<img src="../gfx/console@2x.png" srcset="../gfx/console@2x.png 2x" alt="[2022-05-06 18:35:00] Example Code&#x0A;Processed 3 lines.">
</figure>
</section>


<section id="cf">
<h2>関連項目</h2>
<ul>
	<li><a href="script_overview.html">MacのCotEditorの作業をスクリプトで自動化する</a></li>
</ul>
</section>

</body>
</html>
